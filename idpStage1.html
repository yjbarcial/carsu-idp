<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Individual Development Plan ‚Äî CarSU HRMS</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --navy: #1a4d2e;
        --navy-mid: #2d6a3f;
        --gold: #f5c300;
        --gold-light: #ffd740;
        --cream: #faf8f4;
        --white: #ffffff;
        --text: #1a1a2e;
        --text-light: #5a6070;
        --border: #d8d4c8;
        --error: #c0392b;
        --success: #1a6b3c;
        --input-bg: #f8f7f4;
        --shadow: 0 4px 24px rgba(26, 77, 46, 0.1);
        --shadow-sm: 0 2px 8px rgba(26, 77, 46, 0.07);
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Source Sans 3", sans-serif;
        background: var(--cream);
        color: var(--text);
        min-height: 100vh;
        font-size: 15px;
        line-height: 1.6;
      }

      /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
      .site-header {
        background: #ffffff;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        border-bottom: 3px solid var(--navy);
      }
      .header-inner {
        width: 100%;
        padding: 0px 24px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
      }
      .header-img {
        width: auto;
        max-width: 700px;
        height: auto;
        display: block;
        object-fit: contain;
        margin-left: 0;
      }
      .header-user {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(26, 77, 46, 0.06);
        padding: 6px 14px;
        border-radius: 20px;
      }
      .header-user span {
        font-size: 13px;
        color: var(--text-light);
      }
      .user-dot {
        width: 8px;
        height: 8px;
        background: #4caf50;
        border-radius: 50%;
      }

      /* ‚îÄ‚îÄ Main container ‚îÄ‚îÄ */
      .container {
        max-width: 1140px;
        margin: 0 auto;
        padding: 48px 40px 80px;
      }

      /* ‚îÄ‚îÄ Form title block ‚îÄ‚îÄ */
      .form-title-block {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 32px;
        border-bottom: 2px solid var(--gold);
      }
      .form-title-block h2 {
        font-family: "Playfair Display", serif;
        font-size: 28px;
        color: var(--navy);
        margin-bottom: 6px;
      }
      .form-title-block p {
        color: var(--text-light);
        font-size: 14px;
      }

      /* ‚îÄ‚îÄ Section card ‚îÄ‚îÄ */
      .section-card {
        background: var(--white);
        border-radius: 12px;
        box-shadow: var(--shadow-sm);
        margin-bottom: 28px;
        overflow: hidden;
        border: 1px solid var(--border);
        animation: fadeUp 0.4s ease both;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .section-card:nth-child(2) { animation-delay: 0.05s; }
      .section-card:nth-child(3) { animation-delay: 0.1s; }
      .section-card:nth-child(4) { animation-delay: 0.15s; }
      .section-card:nth-child(5) { animation-delay: 0.2s; }

      .section-header {
        background: var(--navy);
        padding: 16px 28px;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .section-num {
        background: var(--gold);
        color: var(--navy);
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 13px;
        flex-shrink: 0;
      }
      .section-header h3 {
        color: var(--white);
        font-size: 15px;
        font-weight: 600;
        letter-spacing: 0.03em;
      }
      .section-header p {
        color: rgba(255, 255, 255, 0.6);
        font-size: 12px;
        margin-top: 1px;
      }
      .section-body {
        padding: 36px;
      }

      /* ‚îÄ‚îÄ Form fields ‚îÄ‚îÄ */
      .field-grid {
        display: grid;
        gap: 18px;
      }
      .field-grid-2 {
        grid-template-columns: 1fr 1fr;
      }
      .field-grid-3 {
        grid-template-columns: 1fr 1fr 1fr;
      }

      .field-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .field-group.span-2 {
        grid-column: span 2;
      }
      .field-group.span-3 {
        grid-column: span 3;
      }

      label {
        font-size: 12px;
        font-weight: 600;
        color: var(--navy-mid);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      label .req {
        color: var(--error);
        margin-left: 2px;
      }

      input[type="text"],
      input[type="email"],
      input[type="date"],
      input[type="number"],
      select,
      textarea {
        width: 100%;
        padding: 10px 14px;
        border: 1.5px solid var(--border);
        border-radius: 8px;
        background: var(--input-bg);
        font-family: "Source Sans 3", sans-serif;
        font-size: 14px;
        color: var(--text);
        transition: border-color 0.2s, box-shadow 0.2s;
        outline: none;
      }
      select {
        width: 220px;
        min-width: 160px;
        max-width: 100%;
        padding: 10px 14px;
        font-size: 15px;
        border-radius: 8px;
        border: 1.5px solid var(--border);
        background: var(--input-bg);
        color: var(--text);
        margin-bottom: 12px;
      }
      input:focus,
      select:focus,
      textarea:focus {
        border-color: var(--navy);
        box-shadow: 0 0 0 3px rgba(26, 77, 46, 0.08);
        background: var(--white);
      }
      input.error,
      select.error {
        border-color: var(--error);
      }
      input.valid {
        border-color: var(--success);
      }
      textarea {
        resize: vertical;
        min-height: 80px;
      }
      select {
        cursor: pointer;
      }

      /* ‚îÄ‚îÄ Email hint ‚îÄ‚îÄ */
      .email-hint {
        font-size: 12px;
        margin-top: 2px;
        min-height: 16px;
        display: block;
      }
      .email-hint.error {
        color: var(--error);
      }
      .email-hint.success {
        color: var(--success);
      }

      /* ‚îÄ‚îÄ Checkbox groups ‚îÄ‚îÄ */
      .checkbox-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 4px;
      }
      .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 8px 14px;
        border: 1.5px solid var(--border);
        border-radius: 8px;
        background: var(--input-bg);
        transition: all 0.2s;
        font-size: 13px;
      }
      .checkbox-item:hover {
        border-color: var(--navy);
        background: var(--white);
      }
      .checkbox-item input[type="checkbox"],
      .checkbox-item input[type="radio"] {
        width: auto;
        padding: 0;
        border: none;
        background: none;
        accent-color: var(--navy);
        cursor: pointer;
      }
      .checkbox-item.checked {
        border-color: var(--navy);
        background: rgba(26, 77, 46, 0.05);
      }

      /* ‚îÄ‚îÄ Dynamic tables ‚îÄ‚îÄ */
      .table-wrapper {
        overflow-x: auto;
        margin-top: 16px;
      }
      .dynamic-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 13px;
        min-width: 700px;
      }
      .dynamic-table thead tr {
        background: var(--navy-mid);
      }
      .dynamic-table thead th {
        padding: 10px 12px;
        color: var(--white);
        font-weight: 600;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        text-align: left;
        border-right: 1px solid rgba(255, 255, 255, 0.1);
      }
      .dynamic-table thead th:last-child {
        border-right: none;
      }
      .dynamic-table tbody tr {
        border-bottom: 1px solid var(--border);
        transition: background 0.15s;
      }
      .dynamic-table tbody tr:hover {
        background: #f5f4f0;
      }
      .dynamic-table tbody td {
        padding: 8px 10px;
        vertical-align: top;
        border-right: 1px solid var(--border);
      }
      .dynamic-table tbody td:last-child {
        border-right: none;
        text-align: center;
      }
      .dynamic-table td input,
      .dynamic-table td select,
      .dynamic-table td textarea {
        padding: 6px 10px;
        font-size: 13px;
        border-radius: 6px;
      }
      .priority-num {
        width: 36px;
        text-align: center;
        font-weight: 600;
        color: var(--navy);
        background: rgba(245, 195, 0, 0.15);
        border-color: var(--gold);
      }

      /* ‚îÄ‚îÄ Add/Remove row buttons ‚îÄ‚îÄ */
      .table-actions {
        display: flex;
        gap: 10px;
        margin-top: 12px;
      }
      .btn-add-row {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        background: var(--navy);
        color: var(--white);
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
        font-family: "Source Sans 3", sans-serif;
      }
      .btn-add-row:hover {
        background: var(--navy-mid);
      }
      .btn-remove-row {
        background: none;
        border: none;
        cursor: pointer;
        color: var(--error);
        padding: 4px;
        border-radius: 4px;
        font-size: 18px;
        line-height: 1;
        transition: background 0.15s;
      }
      .btn-remove-row:hover {
        background: rgba(192, 57, 43, 0.08);
      }

      /* ‚îÄ‚îÄ Section description ‚îÄ‚îÄ */
      .section-desc {
        background: rgba(245, 195, 0, 0.1);
        border-left: 3px solid var(--gold);
        padding: 12px 16px;
        border-radius: 0 8px 8px 0;
        margin-bottom: 20px;
        font-size: 13px;
        color: var(--text-light);
        line-height: 1.6;
      }
      .section-desc a {
        color: var(--navy);
      }

      /* ‚îÄ‚îÄ Other specify ‚îÄ‚îÄ */
      .other-specify {
        margin-top: 10px;
        display: none;
      }
      .other-specify.visible {
        display: block;
      }

      /* ‚îÄ‚îÄ Submit area ‚îÄ‚îÄ */
      .submit-area {
        background: var(--white);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 36px;
        text-align: center;
        box-shadow: var(--shadow-sm);
      }
      .submit-area p {
        font-size: 13px;
        color: var(--text-light);
        margin-bottom: 18px;
      }
      .btn-submit {
        padding: 14px 48px;
        background: var(--navy);
        color: var(--white);
        border: none;
        border-radius: 10px;
        font-family: "Source Sans 3", sans-serif;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        letter-spacing: 0.03em;
        transition: background 0.2s, transform 0.15s, box-shadow 0.2s;
        box-shadow: 0 4px 16px rgba(26, 77, 46, 0.2);
      }
      .btn-submit:hover {
        background: var(--navy-mid);
        transform: translateY(-1px);
        box-shadow: 0 6px 20px rgba(26, 77, 46, 0.25);
      }
      .btn-submit:active {
        transform: translateY(0);
      }
      .btn-submit:disabled {
        background: #aaa;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* ‚îÄ‚îÄ Loading overlay ‚îÄ‚îÄ */
      .overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(13, 27, 62, 0.6);
        z-index: 999;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        gap: 16px;
      }
      .overlay.active {
        display: flex;
      }
      .spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(255, 255, 255, 0.2);
        border-top-color: var(--gold);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .overlay p {
        color: var(--white);
        font-size: 15px;
      }

      /* ‚îÄ‚îÄ Success screen ‚îÄ‚îÄ */
      .success-screen {
        display: none;
        max-width: 560px;
        margin: 80px auto;
        text-align: center;
        background: var(--white);
        border-radius: 16px;
        padding: 48px 40px;
        box-shadow: var(--shadow);
        border: 1px solid var(--border);
      }
      .success-screen.active {
        display: block;
      }
      .success-icon {
        width: 72px;
        height: 72px;
        background: rgba(26, 107, 60, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        margin: 0 auto 24px;
      }
      .success-screen h2 {
        font-family: "Playfair Display", serif;
        font-size: 24px;
        color: var(--navy);
        margin-bottom: 12px;
      }
      .success-screen p {
        color: var(--text-light);
        font-size: 14px;
        margin-bottom: 20px;
      }
      .ref-id-box {
        background: var(--navy);
        color: var(--gold-light);
        font-family: monospace;
        font-size: 22px;
        font-weight: 700;
        padding: 16px 24px;
        border-radius: 10px;
        letter-spacing: 0.1em;
        margin: 16px 0 24px;
      }

      /* ‚îÄ‚îÄ PDF Button ‚îÄ‚îÄ */
      .btn-pdf {
        display: inline-flex;
        align-items: center;
        gap: 7px;
        padding: 11px 24px;
        background: var(--navy);
        color: var(--white);
        border: none;
        border-radius: 9px;
        font-family: "Source Sans 3", sans-serif;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s, transform 0.15s;
        box-shadow: 0 4px 16px rgba(26, 77, 46, 0.2);
        margin-top: 8px;
      }
      .btn-pdf:hover {
        background: var(--navy-mid);
        transform: translateY(-1px);
      }
      .btn-pdf svg {
        width: 15px;
        height: 15px;
        stroke: currentColor;
        fill: none;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
      }
      #printArea {
        display: none;
      }
      @media print {
        body * { visibility: hidden !important; }
        #printArea, #printArea * { visibility: visible !important; }
        #printArea {
          position: fixed !important;
          inset: 0 !important;
          background: #fff !important;
          padding: 20px 28px !important;
          overflow: auto !important;
          z-index: 9999 !important;
          font-size: 11px !important;
        }
        .no-print { display: none !important; }
        table { page-break-inside: avoid; }
      }

      /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
      @media (max-width: 640px) {
        .container { padding: 24px 16px 60px; }
        .field-grid-2, .field-grid-3 { grid-template-columns: 1fr; }
        .field-group.span-2, .field-group.span-3 { grid-column: span 1; }
        .section-body { padding: 24px 20px; }
        .header-inner { padding: 8px 16px; }
        }

      /* ‚îÄ‚îÄ Page Nav Bar (Back button strip) ‚îÄ‚îÄ */
      .page-nav {
        background: var(--navy);
        padding: 0 28px;
        display: flex;
        align-items: center;
        gap: 0;
        border-bottom: 1px solid rgba(255,255,255,0.08);
      }
      .page-nav a.back-link {
        display: inline-flex;
        align-items: center;
        gap: 9px;
        padding: 10px 0;
        color: rgba(255,255,255,0.75);
        text-decoration: none;
        font-size: 12.5px;
        font-weight: 500;
        font-family: "Source Sans 3", sans-serif;
        letter-spacing: 0.02em;
        transition: color 0.2s;
        position: relative;
      }
      .page-nav a.back-link::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: var(--gold);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.25s ease;
      }
      .page-nav a.back-link:hover {
        color: #fff;
      }
      .page-nav a.back-link:hover::after {
        transform: scaleX(1);
      }
      .page-nav a.back-link svg {
        width: 13px;
        height: 13px;
        stroke: currentColor;
        fill: none;
        stroke-width: 2.5;
        stroke-linecap: round;
        stroke-linejoin: round;
        transition: transform 0.2s;
        flex-shrink: 0;
        opacity: 0.8;
      }
      .page-nav a.back-link:hover svg {
        transform: translateX(-3px);
        opacity: 1;
      }
      .page-nav .nav-sep {
        color: rgba(255,255,255,0.25);
        font-size: 13px;
        margin: 0 10px;
        user-select: none;
      }
      .page-nav .nav-current {
        font-size: 12.5px;
        color: var(--gold);
        font-weight: 600;
        font-family: "Source Sans 3", sans-serif;
        letter-spacing: 0.03em;
      }

      @media (max-width: 640px) {
        .page-nav { padding: 0 16px; }
        .page-nav .nav-current { display: none; }
        .page-nav .nav-sep { display: none; }
      }
    </style>
  </head>
  <body>
    <!-- Loading overlay -->
    <div class="overlay" id="loadingOverlay">
      <div class="spinner"></div>
      <p>Submitting your IDP, please wait‚Ä¶</p>
    </div>

    <!-- Site header -->
    <header class="site-header">
      <div class="header-inner">
        <img
          src="img/header-logo.png"
          alt="Caraga State University - Office of Human Resource Management Services"
          class="header-img"
        />
      </div>
    </header>

    <!-- Page nav breadcrumb -->
    <div class="page-nav">
      <a href="index.html" class="back-link">
        <svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg>
        Back to Home
      </a>
      <span class="nav-sep">/</span>
      <span class="nav-current">Individual Development Plan (IDP)</span>
    </div>

    <!-- Success screen -->
    <div class="success-screen" id="successScreen">
      <div class="success-icon">‚úì</div>
      <h2>IDP Successfully Submitted</h2>
      <p>
        Your Individual Development Plan has been received. Your supervisor has
        been notified and has <strong>3 days</strong> to complete their
        assessment.
      </p>
      <div class="ref-id-box" id="refIdDisplay">‚Äî</div>
      <p>
        Please keep your <strong>Reference ID</strong> for your records. You
        will receive an email confirmation shortly.
      </p>
      <p style="color:#1a6b3c; font-weight:600; margin-top:16px;">
  üìß A complete copy of your IDP (including your supervisor's assessment) will be emailed to you once your supervisor submits their review.
</p>
      <br>
      <a href="index.html" style="display:inline-flex;align-items:center;gap:7px;margin-top:12px;padding:11px 24px;background:rgba(26,77,46,0.08);color:var(--navy);border:1.5px solid rgba(26,77,46,0.2);border-radius:9px;font-family:'Source Sans 3',sans-serif;font-size:14px;font-weight:600;text-decoration:none;transition:all 0.2s" onmouseover="this.style.background='var(--navy)';this.style.color='#fff'" onmouseout="this.style.background='rgba(26,77,46,0.08)';this.style.color='var(--navy)'">
        ‚Üê Return to Home
      </a>
    </div>
    <div id="printArea"></div>

    <!-- Main form -->
    <div class="container" id="mainForm">
      <div class="form-title-block">
        <h2>Individual Development Plan (IDP)</h2>
        <p>
          Complete all sections carefully. Your supervisor will be notified
          automatically upon submission.
        </p>
      </div>

      <!-- ‚ïê‚ïê HEADER INFO ‚ïê‚ïê -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-num">H</div>
          <div>
            <h3>Personnel Information</h3>
            <p>Basic details and submission purpose</p>
          </div>
        </div>
        <div class="section-body">
          <!-- Campus -->
          <div class="field-group" style="margin-bottom: 20px">
            <label>Campus <span class="req">*</span></label>
            <div class="checkbox-group" id="campusGroup">
              <label class="checkbox-item">
                <input type="radio" name="campus" value="CSU Main Campus" /> CSU
                Main Campus
              </label>
              <label class="checkbox-item">
                <input type="radio" name="campus" value="CSU Cabadbaran City Campus" />
                CSU Cabadbaran City Campus
              </label>
            </div>
          </div>

          <!-- Office Affiliation -->
          <div class="field-group" style="margin-bottom: 20px">
            <label>Office Affiliation <span class="req">*</span></label>
            <div class="checkbox-group" id="officeGroup">
              <label class="checkbox-item"><input type="radio" name="officeAffiliation" value="OVPAF" /> OVPAF</label>
              <label class="checkbox-item"><input type="radio" name="officeAffiliation" value="OVPAA" /> OVPAA</label>
              <label class="checkbox-item"><input type="radio" name="officeAffiliation" value="OVPEO" /> OVPEO</label>
              <label class="checkbox-item"><input type="radio" name="officeAffiliation" value="OVPAF" /> OVPSAS</label>
              <label class="checkbox-item"><input type="radio" name="officeAffiliation" value="OVPRDIE" /> OVPRDIE</label>
              <label class="checkbox-item">
                <input type="radio" name="officeAffiliation" value="Office of the Campus Director" />
                Office of the Campus Director
              </label>
            </div>
          </div>

          <div class="field-grid field-grid-2" style="margin-bottom: 18px">
            <div class="field-group span-2">
              <label>College / Office / Unit <span class="req">*</span></label>
              <input type="text" id="collegeOfficeUnit" placeholder="e.g. College of Engineering" />
            </div>
          </div>

          <div class="field-grid field-grid-2" style="margin-bottom: 18px">
            <div class="field-group">
              <label>Name of Personnel <span class="req">*</span></label>
              <input type="text" id="nameOfPersonnel" placeholder="Full name" />
            </div>
            <div class="field-group">
              <label>Your CarSU Email Address <span class="req">*</span></label>
              <input type="email" id="employeeEmail" placeholder="yourname@carsu.edu.ph" autocomplete="email" />
              <small class="email-hint" id="employeeEmailHint"></small>
            </div>
            <div class="field-group">
              <label>Date Prepared <span class="req">*</span></label>
              <input type="date" id="datePrepared" />
            </div>
            <div class="field-group">
              <label>Current Position / Designation <span class="req">*</span></label>
              <input type="text" id="currentPosition" placeholder="e.g. Instructor I" />
            </div>
            <div class="field-group">
              <label>Year Covered <span class="req">*</span></label>
              <input type="text" id="yearCovered" placeholder="e.g. 2025" />
            </div>
            <div class="field-group">
              <label>Years in Position <span class="req">*</span></label>
              <input type="number" id="yearsInPosition" min="0" placeholder="0" />
            </div>
            <div class="field-group">
              <label>Years in CSU <span class="req">*</span></label>
              <input type="number" id="yearsInCSU" min="0" placeholder="0" />
            </div>
          </div>

          <!-- Supervisor fields -->
          <div class="field-grid field-grid-2" style="margin-bottom: 20px">
            <div class="field-group">
              <label>Immediate Supervisor Name <span class="req">*</span></label>
              <input type="text" id="supervisorName" placeholder="e.g. Dr. Juan Dela Cruz" />
            </div>
            <div class="field-group">
              <label>Supervisor CarSU Email <span class="req">*</span></label>
              <input type="email" id="supervisorEmail" placeholder="supervisor@carsu.edu.ph" />
              <small class="email-hint" id="supervisorEmailHint"></small>
            </div>
          </div>

          <!-- Purpose -->
          <div class="field-group">
            <label>Purpose <span class="req">*</span></label>
            <div class="checkbox-group" id="headerPurposeGroup">
              <label class="checkbox-item"><input type="radio" name="headerPurpose" value="Initial Assessment" /> Initial Assessment</label>
              <label class="checkbox-item"><input type="radio" name="headerPurpose" value="Mid-Year Review" /> Mid-Year Review</label>
              <label class="checkbox-item"><input type="radio" name="headerPurpose" value="Annual Review" /> Annual Review</label>
              <label class="checkbox-item"><input type="radio" name="headerPurpose" value="Other" /> Other</label>
            </div>
            <div class="other-specify" id="headerPurposeOther">
              <input type="text" id="headerPurposeOtherText" placeholder="Please specify‚Ä¶" />
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê SECTION I: COMPETENCY ASSESSMENT ‚ïê‚ïê -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-num">I</div>
          <div>
            <h3>Competency Assessment</h3>
            <p>Identify key competencies to develop</p>
          </div>
        </div>
        <div class="section-body">
          <div class="section-desc">
            Identify key competencies you need to develop based on your current
            or target role. For detailed descriptions and behavioral indicators, please refer to the
            <a href="https://tinyurl.com/CompetencyManualandModel" target="_blank">Competency Manual and Model</a>.
          </div>

          <div class="field-group" style="margin-bottom: 20px">
            <label>Purpose <span class="req">*</span></label>
            <div class="checkbox-group" id="competencyPurposeGroup">
              <label class="checkbox-item"><input type="radio" name="compPurpose" value="To meet the competencies of my current position." /> Meet competencies of current position</label>
              <label class="checkbox-item"><input type="radio" name="compPurpose" value="To increase the level of competencies of the current position." /> Increase level of current competencies</label>
              <label class="checkbox-item"><input type="radio" name="compPurpose" value="To meet the competencies of the next higher position." /> Meet competencies of next higher position</label>
              <label class="checkbox-item"><input type="radio" name="compPurpose" value="To acquire new competencies across different functions/positions." /> Acquire new competencies across functions</label>
              <label class="checkbox-item"><input type="radio" name="compPurpose" value="Others" /> Others</label>
            </div>
            <div class="other-specify" id="compPurposeOther">
              <input type="text" id="compPurposeOtherText" placeholder="Please specify‚Ä¶" />
            </div>
          </div>

          <div class="table-wrapper">
            <table class="dynamic-table" id="competencyTable">
              <thead>
                <tr>
                  <th style="width: 50px">No.</th>
                  <th>Target Competency</th>
                  <th style="width: 130px">Current Level</th>
                  <th style="width: 130px">Required Level</th>
                  <th>Suggested LeaD Interventions</th>
                  <th>Resource / Support Needed</th>
                  <th style="width: 120px">Target Timeline</th>
                  <th style="width: 40px"></th>
                </tr>
              </thead>
              <tbody id="competencyBody"></tbody>
            </table>
          </div>
          <div class="table-actions">
            <button class="btn-add-row" onclick="addRow('competency')">+ Add Row</button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê SECTION II: AGAP ‚ïê‚ïê -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-num">II</div>
          <div>
            <h3>Academic Growth and Advancement Program (AGAP)</h3>
            <p>Plans for academic advancement</p>
          </div>
        </div>
        <div class="section-body">
          <div class="section-desc">
            Outline your plans for academic advancement, such as enrolling in
            graduate or certification programs. Ensure alignment with your role and CSU's academic goals.
          </div>
          <div class="table-wrapper">
            <table class="dynamic-table" id="agapTable">
              <thead>
                <tr>
                  <th style="width: 50px">No.</th>
                  <th>Degree Program</th>
                  <th>Target HEI</th>
                  <th style="width: 120px">Mode of Study</th>
                  <th>Source of Funding</th>
                  <th>Target Scholarship Grant</th>
                  <th style="width: 120px">Target Timeline</th>
                  <th style="width: 40px"></th>
                </tr>
              </thead>
              <tbody id="agapBody"></tbody>
            </table>
          </div>
          <div class="table-actions">
            <button class="btn-add-row" onclick="addRow('agap')">+ Add Row</button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê SECTION III: PRO-ACT ‚ïê‚ïê -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-num">III</div>
          <div>
            <h3>Professional Advancement through Capacity-Building and Trainings (Pro-ACT)</h3>
            <p>Training and workshop interventions</p>
          </div>
        </div>
        <div class="section-body">
          <div class="section-desc">
            If a training intervention is identified in Part I (Competency Assessment), provide more detailed information here.
          </div>
          <div class="table-wrapper">
            <table class="dynamic-table" id="proactTable">
              <thead>
                <tr>
                  <th style="width: 50px">No.</th>
                  <th>Training / Workshop Title</th>
                  <th>Target Competency / Skill</th>
                  <th style="width: 130px">Mode of Activity</th>
                  <th>Source of Funding</th>
                  <th>Trainer / Provider</th>
                  <th style="width: 120px">Target Timeline</th>
                  <th style="width: 40px"></th>
                </tr>
              </thead>
              <tbody id="proactBody"></tbody>
            </table>
          </div>
          <div class="table-actions">
            <button class="btn-add-row" onclick="addRow('proact')">+ Add Row</button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê SUBMIT ‚ïê‚ïê -->
      <div class="submit-area">
        <p>
          By submitting, you confirm that all information provided is accurate.
          Your supervisor will be notified automatically.
        </p>
        <button class="btn-submit" id="submitBtn" onclick="submitForm()">
          Submit IDP
        </button>
      </div>
    </div>
    <!-- /container -->

    <script>
      const APPS_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbzISVUiTVdESC9iOIeqSKHw3L1gwotLFTlIuaXqfSQnEpMuNHF72RGp8Ajdced5YyM_/exec";

      let rowCounts = { competency: 0, agap: 0, proact: 0 };
      let lastPayload = null;

      function esc(s) {
        return String(s || "‚Äî")
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function doPrint() {
        if (!lastPayload) { alert("No submission data available to print."); return; }
        const p = lastPayload;
        const refId = p._refId || "‚Äî";
        const dateNow = new Date().toLocaleDateString("en-PH", { year: "numeric", month: "long", day: "numeric" });

        function tableHTML(rows, cols, headers) {
          if (!rows || !rows.length) return `<p style="font-size:11px;color:#888;font-style:italic">No entries.</p>`;
          let h = `<table style="width:100%;border-collapse:collapse;font-size:11px;margin-bottom:12px;border:1px solid #d8d4c8">
            <thead><tr style="background:#2d6a3f;color:#fff">${headers.map(hd => `<th style="padding:5px 8px;text-align:left">${esc(hd)}</th>`).join("")}</tr></thead><tbody>`;
          rows.forEach((row, i) => {
            h += `<tr style="background:${i % 2 ? "#f9f8f5" : "#fff"}">${cols.map(c => `<td style="padding:4px 8px;border-right:1px solid #d8d4c8">${esc(row[c])}</td>`).join("")}</tr>`;
          });
          return h + `</tbody></table>`;
        }

        const html = `<div style="font-family:Georgia,serif;color:#1a1a2e;max-width:900px">
          <div style="border-bottom:3px solid #1a4d2e;padding-bottom:10px;margin-bottom:18px">
            <div style="font-size:9px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:#5a6070;margin-bottom:3px">Caraga State University ‚Äî Office of Human Resource Management Services</div>
            <h1 style="font-size:18px;color:#1a4d2e;margin-bottom:2px;font-family:Georgia,serif">Individual Development Plan (IDP)</h1>
            <p style="font-size:11px;color:#5a6070">Reference ID: <strong>${esc(refId)}</strong> &nbsp;¬∑&nbsp; Printed: ${dateNow}</p>
          </div>
          <h3 style="font-size:12px;color:#1a4d2e;margin:0 0 8px;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid #d8d4c8;padding-bottom:4px">Personnel Information</h3>
          <table style="width:100%;border-collapse:collapse;font-size:11px;margin-bottom:16px">
            <tr><td style="padding:3px 8px;width:25%;color:#5a6070;font-size:10px;font-weight:700;text-transform:uppercase">Name of Personnel</td><td style="padding:3px 8px;width:25%">${esc(p.nameOfPersonnel)}</td>
                <td style="padding:3px 8px;width:25%;color:#5a6070;font-size:10px;font-weight:700;text-transform:uppercase">Email</td><td style="padding:3px 8px">${esc(p.employeeEmail)}</td></tr>
            <tr style="background:#faf9f6"><td style="padding:3px 8px;color:#5a6070;font-size:10px;font-weight:700;text-transform:uppercase">Current Position</td><td style="padding:3px 8px">${esc(p.currentPosition)}</td>
                <td style="padding:3px 8px;color:#5a6070;font-size:10px;font-weight:700;text-transform:uppercase">Office/Unit</td><td style="padding:3px 8px">${esc(p.collegeOfficeUnit)}</td></tr>
            <tr><td style="padding:3px 8px;color:#5a6070;font-size:10px;font-weight:700;text-transform:uppercase">Campus</td><td style="padding:3px 8px">${esc(p.campus)}</td>
                <td style="padding:3px 8px;color:#5a6070;font-size:10px;font-weight:700;text-transform:uppercase">Affiliation</td><td style="padding:3px 8px">${esc(p.officeAffiliation)}</td></tr>
          </table>
          <h3 style="font-size:12px;color:#1a4d2e;margin:14px 0 8px;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid #d8d4c8;padding-bottom:4px">I. Competency-Based LeaD</h3>
          ${tableHTML(p.competencyRows, ["priority","targetCompetency","currentLevel","requiredLevel","leadInterventions","resourceSupport","targetTimeline"], ["#","Target Competency","Current Level","Required Level","LeaD Interventions","Resource/Support","Timeline"])}
          <h3 style="font-size:12px;color:#1a4d2e;margin:14px 0 8px;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid #d8d4c8;padding-bottom:4px">II. AGAP</h3>
          ${tableHTML(p.agapRows, ["priority","degreeProgram","targetHEI","modeOfStudy","sourceOfFunding","scholarshipGrant","targetTimeline"], ["#","Degree Program","Target HEI","Mode of Study","Source of Funding","Scholarship/Grant","Timeline"])}
          <h3 style="font-size:12px;color:#1a4d2e;margin:14px 0 8px;text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid #d8d4c8;padding-bottom:4px">III. Pro-ACT</h3>
          ${tableHTML(p.proactRows, ["priority","trainingTitle","targetSkill","modeOfActivity","sourceOfFunding","trainerProvider","targetTimeline"], ["#","Training Title","Target Skill","Mode of Activity","Source of Funding","Trainer/Provider","Timeline"])}
          <div style="margin-top:28px;padding-top:10px;border-top:1px solid #d8d4c8;font-size:9px;color:#aaa">
            Submitted via CarSU HRMS IDP Tool &nbsp;¬∑&nbsp; ${dateNow} &nbsp;¬∑&nbsp; Ref: ${esc(refId)}
          </div>
        </div>`;

        const pa = document.getElementById("printArea");
        pa.innerHTML = html;
        pa.style.display = "block";
        window.print();
        setTimeout(() => { pa.style.display = "none"; pa.innerHTML = ""; }, 1500);
      }

      window.addEventListener("DOMContentLoaded", () => {
        document.getElementById("datePrepared").valueAsDate = new Date();

        document.querySelectorAll(".checkbox-item input").forEach(input => {
          input.addEventListener("change", function () {
            const name = this.name;
            if (name) {
              document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                r.closest(".checkbox-item").classList.toggle("checked", r.checked);
              });
            }
            if (this.value === "Other" || this.value === "Others") {
              const otherId = name === "headerPurpose" ? "headerPurposeOther" : "compPurposeOther";
              const el = document.getElementById(otherId);
              if (el) el.classList.toggle("visible", this.checked);
            } else if (this.type === "radio") {
              const otherId = name === "headerPurpose" ? "headerPurposeOther" : "compPurposeOther";
              const el = document.getElementById(otherId);
              if (el) el.classList.remove("visible");
            }
          });
        });

        document.getElementById("employeeEmail").addEventListener("blur", function () {
          validateCarsuEmail(this, "employeeEmailHint");
        });
        document.getElementById("supervisorEmail").addEventListener("blur", function () {
          validateCarsuEmail(this, "supervisorEmailHint");
        });

        addRow("competency");
        addRow("agap");
        addRow("proact");
      });

      function clearEmailHint(inputEl, hintId) {
        inputEl.classList.remove("error", "valid");
        const hint = document.getElementById(hintId);
        hint.textContent = "";
        hint.className = "email-hint";
      }

      function validateCarsuEmail(inputEl, hintId) {
        const val = inputEl.value.trim();
        const hint = document.getElementById(hintId);
        if (!val) { clearEmailHint(inputEl, hintId); return false; }
        if (!val.endsWith("@carsu.edu.ph")) {
          inputEl.classList.add("error");
          inputEl.classList.remove("valid");
          hint.textContent = "Must be a @carsu.edu.ph email address.";
          hint.className = "email-hint error";
          return false;
        }
        inputEl.classList.add("valid");
        inputEl.classList.remove("error");
        hint.textContent = "‚úì Valid CarSU email";
        hint.className = "email-hint success";
        return true;
      }

      function addRow(type) {
        rowCounts[type]++;
        const n = rowCounts[type];
        const tbody = document.getElementById(type + "Body");
        const tr = document.createElement("tr");

        if (type === "competency") {
          tr.innerHTML = `
            <td><input type="text" class="priority-num" value="${n}" readonly/></td>
            <td><textarea rows="2" placeholder=""></textarea></td>
            <td><select><option value="">Select‚Ä¶</option><option>Basic</option><option>Intermediate</option><option>Advanced</option><option>Expert</option></select></td>
            <td><select><option value="">Select‚Ä¶</option><option>Basic</option><option>Intermediate</option><option>Advanced</option><option>Expert</option></select></td>
            <td><textarea rows="2" placeholder=""></textarea></td>
            <td><textarea rows="2" placeholder=""></textarea></td>
            <td><input type="text" placeholder=""/></td>
            <td><button class="btn-remove-row" onclick="removeRow(this)" title="Remove row">√ó</button></td>`;
        } else if (type === "agap") {
          tr.innerHTML = `
            <td><input type="text" class="priority-num" value="${n}" readonly/></td>
            <td><input type="text" placeholder=""/></td>
            <td><input type="text" placeholder=""/></td>
            <td><select><option value="">Select‚Ä¶</option><option>Full-time</option><option>Part-time</option><option>Online</option><option>Blended</option></select></td>
            <td><input type="text" placeholder=""/></td>
            <td><input type="text" placeholder=""/></td>
            <td><input type="text" placeholder=""/></td>
            <td><button class="btn-remove-row" onclick="removeRow(this)" title="Remove row">√ó</button></td>`;
        } else if (type === "proact") {
          tr.innerHTML = `
            <td><input type="text" class="priority-num" value="${n}" readonly/></td>
            <td><input type="text" placeholder=""/></td>
            <td><input type="text" placeholder=""/></td>
            <td><select><option value="">Select‚Ä¶</option><option>Face-to-face</option><option>Online</option><option>Blended</option><option>On-the-job</option></select></td>
            <td><input type="text" placeholder=""/></td>
            <td><input type="text" placeholder=""/></td>
            <td><input type="text" placeholder=""/></td>
            <td><button class="btn-remove-row" onclick="removeRow(this)" title="Remove row">√ó</button></td>`;
        }

        tbody.appendChild(tr);
        tr.style.animation = "fadeUp 0.25s ease";
      }

      function removeRow(btn) {
        const tr = btn.closest("tr");
        const tbody = tr.closest("tbody");
        if (tbody.children.length <= 1) return;
        tr.remove();
        Array.from(tbody.querySelectorAll(".priority-num")).forEach((el, i) => (el.value = i + 1));
      }

      function collectTableData(type) {
        const rows = [];
        const tbody = document.getElementById(type + "Body");
        Array.from(tbody.querySelectorAll("tr")).forEach(tr => {
          const cells = tr.querySelectorAll("input, select, textarea");
          const row = {};
          if (type === "competency") {
            row.priority = cells[0]?.value;
            row.targetCompetency = cells[1]?.value;
            row.currentLevel = cells[2]?.value;
            row.requiredLevel = cells[3]?.value;
            row.leadInterventions = cells[4]?.value;
            row.resourceSupport = cells[5]?.value;
            row.targetTimeline = cells[6]?.value;
          } else if (type === "agap") {
            row.priority = cells[0]?.value;
            row.degreeProgram = cells[1]?.value;
            row.targetHEI = cells[2]?.value;
            row.modeOfStudy = cells[3]?.value;
            row.sourceOfFunding = cells[4]?.value;
            row.scholarshipGrant = cells[5]?.value;
            row.targetTimeline = cells[6]?.value;
          } else if (type === "proact") {
            row.priority = cells[0]?.value;
            row.trainingTitle = cells[1]?.value;
            row.targetSkill = cells[2]?.value;
            row.modeOfActivity = cells[3]?.value;
            row.sourceOfFunding = cells[4]?.value;
            row.trainerProvider = cells[5]?.value;
            row.targetTimeline = cells[6]?.value;
          }
          rows.push(row);
        });
        return rows;
      }

      function validate() {
        let ok = true;
        const required = [["nameOfPersonnel"],["datePrepared"],["currentPosition"],["yearCovered"],["yearsInPosition"],["yearsInCSU"],["collegeOfficeUnit"],["supervisorName"]];
        required.forEach(([id]) => {
          const el = document.getElementById(id);
          if (!el.value.trim()) { el.classList.add("error"); ok = false; }
          else el.classList.remove("error");
        });

        const empEmail = document.getElementById("employeeEmail").value.trim();
        if (!empEmail) {
          document.getElementById("employeeEmail").classList.add("error");
          document.getElementById("employeeEmailHint").textContent = "Email address is required.";
          document.getElementById("employeeEmailHint").className = "email-hint error";
          ok = false;
        } else if (!empEmail.endsWith("@carsu.edu.ph")) {
          document.getElementById("employeeEmail").classList.add("error");
          document.getElementById("employeeEmailHint").textContent = "Only @carsu.edu.ph emails are allowed.";
          document.getElementById("employeeEmailHint").className = "email-hint error";
          alert("Only CarSU email addresses (@carsu.edu.ph) are allowed to submit an IDP.");
          ok = false;
        }

        const supEmail = document.getElementById("supervisorEmail").value.trim();
        if (!supEmail) {
          document.getElementById("supervisorEmail").classList.add("error");
          document.getElementById("supervisorEmailHint").textContent = "Supervisor email is required.";
          document.getElementById("supervisorEmailHint").className = "email-hint error";
          ok = false;
        } else if (!supEmail.endsWith("@carsu.edu.ph")) {
          document.getElementById("supervisorEmail").classList.add("error");
          document.getElementById("supervisorEmailHint").textContent = "Supervisor must have a @carsu.edu.ph email.";
          document.getElementById("supervisorEmailHint").className = "email-hint error";
          alert("Supervisor email must also be a @carsu.edu.ph address.");
          ok = false;
        }

        if (!document.querySelector('input[name="campus"]:checked')) { alert("Please select a Campus."); ok = false; }
        if (!document.querySelector('input[name="officeAffiliation"]:checked')) { alert("Please select an Office Affiliation."); ok = false; }
        if (!document.querySelector('input[name="headerPurpose"]:checked')) { alert("Please select a Purpose."); ok = false; }
        if (!document.querySelector('input[name="compPurpose"]:checked')) { alert("Please select a Competency Assessment Purpose."); ok = false; }

        return ok;
      }

      function submitForm() {
        if (!validate()) return;

        const headerPurposeChecked = document.querySelector('input[name="headerPurpose"]:checked');
        let headerPurpose = headerPurposeChecked?.value || "";
        if (headerPurpose === "Other") headerPurpose = document.getElementById("headerPurposeOtherText").value || "Other";

        const compPurposeChecked = document.querySelector('input[name="compPurpose"]:checked');
        let compPurpose = compPurposeChecked?.value || "";
        if (compPurpose === "Others") compPurpose = document.getElementById("compPurposeOtherText").value || "Others";

        const payload = {
          action: "submitStage1",
          employeeEmail: document.getElementById("employeeEmail").value.trim(),
          campus: document.querySelector('input[name="campus"]:checked')?.value,
          officeAffiliation: document.querySelector('input[name="officeAffiliation"]:checked')?.value,
          collegeOfficeUnit: document.getElementById("collegeOfficeUnit").value.trim(),
          nameOfPersonnel: document.getElementById("nameOfPersonnel").value.trim(),
          datePrepared: document.getElementById("datePrepared").value,
          currentPosition: document.getElementById("currentPosition").value.trim(),
          yearCovered: document.getElementById("yearCovered").value.trim(),
          yearsInPosition: document.getElementById("yearsInPosition").value,
          yearsInCSU: document.getElementById("yearsInCSU").value,
          supervisorName: document.getElementById("supervisorName").value.trim(),
          supervisorEmail: document.getElementById("supervisorEmail").value.trim(),
          headerPurpose,
          competencyPurpose: compPurpose,
          competencyRows: collectTableData("competency"),
          agapRows: collectTableData("agap"),
          proactRows: collectTableData("proact"),
        };

        document.getElementById("loadingOverlay").classList.add("active");
        document.getElementById("submitBtn").disabled = true;

        fetch(APPS_SCRIPT_URL, { method: "POST", body: JSON.stringify(payload) })
          .then(r => r.json())
          .then(data => {
            document.getElementById("loadingOverlay").classList.remove("active");
            if (data.success) {
              lastPayload = payload;
              lastPayload._refId = data.refId;
              document.getElementById("mainForm").style.display = "none";
              document.getElementById("refIdDisplay").textContent = data.refId;
              document.getElementById("successScreen").classList.add("active");
            } else {
              alert("Submission failed: " + data.error);
              document.getElementById("submitBtn").disabled = false;
            }
          })
          .catch(() => {
            document.getElementById("loadingOverlay").classList.remove("active");
            alert("Network error. Please try again.");
            document.getElementById("submitBtn").disabled = false;
          });
      }
    </script>
  </body>
</html>